# Planning Agent システム PRD (Product Requirements Document)

## 1. 製品概要

**プロダクト名**: Planning Agent システム

**コンセプト**: マルチエージェントシステムにおけるプランニング機能を効率化・最適化するエージェントベースのシステム

**目的**: 
- 複数のエージェントが協調して動作するマルチエージェントシステムに対して、効率的かつ柔軟なプランニング機能を提供する
- エージェントシステムの性能における「プランニングの正確さとその管理能力」の重要性を検証する
- プランニングに特化したエージェントシステムの概念実証（PoC）を行う

**仮説検証**:
- 「Agentの性能に直結するのはプランニングの正確さやその管理能力」という仮説を検証する

## 2. 解決する問題

- マルチエージェントシステムにおけるプランニングの複雑さと不確実性
- タスク要件の曖昧さによる実行効率の低下
- 複数エージェント間の協調におけるプラン調整の難しさ
- プラン実行中の変更や調整の柔軟性の欠如

## 3. 主要機能要件

### 3.1 タスク分析機能
- ユーザーから受け取ったタスクを分析
- 曖昧な要素について質問を生成し、タスク要件を明確化
- タスク実行に必要な条件や制約を特定

### 3.2 プラン生成・分解機能
- タスクを具体的な実行可能なサブタスクに分解
- サブタスク間の依存関係を特定
- 実行順序や並列実行可能性を分析

### 3.3 プラン管理機能
- 生成されたプランの実行状況の追跡
- プラン変更の必要性の検出
- プランの動的な調整と更新

### 3.4 エージェント調整機能
- サブタスクに適したエージェントの選定
- エージェント間の情報共有の調整
- エージェント間の協調作業の最適化

## 4. エージェント構成

本システムは以下のエージェントから構成される：

1. **プランニングマネージャエージェント**
   - 全体のプランニングプロセスを統括
   - 他エージェントの調整と監視
   - プラン全体の整合性確保

2. **要件分析エージェント**
   - ユーザー入力の分析
   - 曖昧な要素の特定と質問生成
   - タスク要件の形式化

3. **タスク分解エージェント**
   - タスクをサブタスクに分解
   - サブタスクの実行可能性評価
   - サブタスクの優先順位付け

4. **課題管理エージェント**
   - プロジェクトの課題追跡
   - 課題に基づくプラン更新提案
   - 対応方針の提示

※すべてのエージェントはsmolagentsフレームワークを用いたReActエージェントとして実装される

## 5. 技術仕様

### 5.1 開発環境
- 言語: Python 3.10以上
- フレームワーク: smolagentsフレームワーク
- 開発環境: 個人の開発環境でのみ動作検証

### 5.2 アーキテクチャ
- モジュール構成:
  - エージェント管理モジュール
  - プラン生成モジュール
  - タスク分析モジュール
  - プラン実行・監視モジュール
- データ形式: YAML形式
  - 要件ファイル
  - プランファイル（サブタスクリスト）
  - 課題管理ファイル

### 5.3 インターフェース
- コマンドラインインターフェース（CLI）での操作
- MCP (Model Context Protocol) 対応インターフェース
  - Claudeとの連携を可能にするMCP形式での通信
  - 外付けプランニング機能としての動作
  - OpenAI Agent SDKを使用したPlanningMCPの結合
  - 利用モデル: Claude 3.7 Sonnet
- 将来的なAPI提供を考慮した設計

### 5.4 MCP機能
- CreatePlan: 新規プラン作成機能
- UpdatePlan: プラン更新機能
- ReportIssue: 課題報告・対応方針提示機能
- ResetPlan: タスク情報リセット機能

## 6. 実装範囲と制約

### 6.1 実装範囲
- 基本的なプランニング機能の実装
- シンプルな問題領域でのみ検証
- エージェント間通信の基本的な仕組み
- MCPを介したClaudeとの連携機能
- 外部プランニングエンジンとしての基本機能
- 以下のファイル出力機能:
  - 要件ファイル（YAML形式）
  - プランファイル/サブタスクリスト（YAML形式）
  - 課題管理ファイル（YAML形式）
- プラン履歴管理機能

### 6.2 制約・前提条件
- 個人開発環境での動作を前提
- パフォーマンスやスケーラビリティは検証対象外
- すべてのエージェントはsmolagentsフレームワークのReActエージェントとして実装
- エージェントの詳細なテストより出力結果の検証に重点
- マルチターン対話のサポート（聞き返し機能）
- 初期段階では数独問題のみを対象とした評価

## 7. 検証目標

- プランニングの正確さがエージェントシステム全体の性能に与える影響の測定
- エージェント間の協調によるプランニング効率の向上度合いの確認
- smolagentsフレームワークの有効性と適用限界の把握
- タスク分解アプローチの有効性検証
- MCP形式を介したClaudeとの連携における有効性検証
- 外部プランニングエンジンとしての機能性確認
- Sudoku-Benchを使用したプランニング性能の定量評価
- PlanningAgentありとなしの場合での効率・精度の比較

## 8. 開発ロードマップ

### マイルストーン1: シングルエージェント基本機能とMCP基盤
- 機能実装:
  - 要件定義機能
  - タスク分解機能
  - 要件曖昧性に関する聞き返し機能
  - YAMLファイル出力機能（要件ファイル、プランファイル）
- MCP機能: 
  - CreatePlan
  - ResetPlan
- 評価: Sudoku-Benchによる初期評価実施

### マイルストーン2: プラン更新機能
- 機能実装:
  - プラン更新機能（タスク完了フラグの更新）
  - プラン変更機能（サブタスクの修正）
  - プラン履歴管理機能（古いプランの退避）
- MCP機能:
  - UpdatePlan
- 評価: Sudoku-Benchによる継続的評価

### マイルストーン3: 課題管理機能
- 機能実装:
  - 課題管理機能
  - 課題ファイル出力機能
  - 課題に基づくプラン更新提案機能
- MCP機能:
  - ReportIssue
- 評価: Sudoku-Benchによる継続的評価

### マイルストーン4: マルチエージェント化（要件分析）
- 機能実装:
  - 要件分析エージェントの追加
  - エージェント間通信プロトコルの実装
  - プランニングマネージャエージェントとの連携機能
- 評価: Sudoku-Benchによる継続的評価
- リファクタリング: エージェント間通信の最適化

### マイルストーン5: マルチエージェント化（タスク分解）
- 機能実装:
  - タスク分解エージェントの追加
  - タスク分解プロセスの最適化
  - エージェント間の協調動作検証
- 評価: Sudoku-Benchによる継続的評価

### マイルストーン6: マルチエージェント化（課題管理）
- 機能実装:
  - 課題管理エージェントの追加
  - 課題対応プロセスの最適化
  - 総合的なエージェント協調動作の検証
- 評価: Sudoku-Benchによる最終評価
- 将来構想: API提供に向けた準備

### 完了基準と検証方法
- 各マイルストーンの完了基準:
  - 対応する機能がCLIで実行可能
  - 正常に動作するMCP機能
  - 期待されるファイル出力の確認
  - Sudoku-Benchでの評価結果
- テスト戦略:
  - 出力結果（ファイル、応答）の正確性確認
  - 基本シナリオでの動作検証
  - エラーケースの確認
  - ベンチマーク結果の蓄積と比較

## 9. 評価基準

### 9.1 定量的評価
- **プランニング精度**: Sudoku-Benchを用いた正確性評価
- **タスク実行効率**: PlanningAgentありとなしの場合の比較
- **プラン最適化度合い**: 不要なステップの削減率
- **エージェント数と性能の相関**: マルチエージェント化による性能向上度合い

### 9.2 定性的評価
- **タスク要件明確化の効果**: 曖昧要素の削減とそれによる効率向上
- **システム使用感**: CLIとMCPインターフェースの使いやすさ
- **エラー対応能力**: 異常系ケースでの回復性と対応精度
- **柔軟性**: 異なるタイプのタスクへの適応性

### 9.3 ベンチマーク方法
- Sudoku-Benchを使用した標準的なタスク評価
- 各マイルストーン後にベンチマークを実施
- 結果の継続的な記録と比較分析
- 失敗ケースの蓄積と改善活用

### 9.4 将来的な改善評価
- エージェント数の増加による性能向上の限界点検証
- 複雑なドメイン（数独以外）への適用可能性評価
- MCPインターフェース以外の連携方法の有効性検証

---

**注記**: 本PRDは概念検証（PoC）段階のプロジェクトを対象としており、本格的な製品開発を想定したものではありません。市場分析、ユーザー調査、詳細なリスク分析、予算計画などは含まれていません。